# 网络模块

## 创建TCP服务器

```js
const net = require('net');

const server = net.createServer((sockket)=>{

    console.log('createServer');
});

server.listen(8888, ()=>{
    console.log('listening');
});
```

## 第二种方式

```js
const net = require('net');

const server = net.createServer((socket)=>{
    console.log('client connected');
});

server.listen(8888);

server.on('listening', ()=>{
    console.log('server is listening');
});
```

## 第三种写法

```js
const net = require('net');

const server = net.createServer();

server.on('connection', ()=>{
    console.log('client is connecting');
});

server.listen(8888);

server.on('listening',()=>{
    console.log('listening');
});

server.on('close', ()=>{
    console.log('server closed');
});
```

## server 的端口地址等信息

```js
const net = require('net');
const server = net.createServer((c)=>{
    console.log('server is start');
    console.log(c.localPort);
    console.log(c.address);

});

server.listen(8888);

server.on('listening',()=>{
    console.log('listening');
});
```

## 设置服务的最大连接数

```js
const net = require('net');
const server = net.createServer((socket)=>{
    console.log('client is connected');

    server.maxConnections = 2;

    server.getConnections((errro, count)=>{
        console.log(count);
    });

});

server.listen(8888, ()=>{
    console.log('listening');
});
```

## 数据的监听

```js
const net = require('net');

const server = net.createServer((socket)=>{

    socket.on('data', (data)=>{
        console.log(data.toString());
    });
});

server.listen(8888, ()=>{
    console.log('server is listening');
});
```

> 结果：启动服务端，客户端进行连接，然后客户端输入数据在服务端会打印出来。

## 服务端属性打印

```js
const net = require('net');

const server = net.createServer((socket)=>{
    console.log(socket.localPort);
    console.log(socket.remotePort);
    console.log(socket.remoteFamily);
    console.log(socket.remoteAddress);
    console.log(socket.localAddress);
}).listen(8888,()=>{
    console.log('listening start');
});
```

## 服务器端向客户端写数据

```js
const net = require('net');
net.createServer((socket) => {

    console.log('client is connected');

    const message = 'server address is' + JSON.stringify(socket.address());

    socket.write(message, () => {
        const writeSize = socket.bytesWritten;

        console.log(message);
        console.log('message size is :' + writeSize);
    });

    socket.on('data', (data) => {
        console.log(data.toString());
        const readSize = socket.bytesRead;
        console.log('data size is ' + readSize);
    });

}).listen(8888, () => {
    console.log('listening start');
});
```

## 客户端创建

```js
const net = require('net');

const client = new net.Socket();

client.connect({port:8888,host:'localhost'}, ()=>{
    console.log('client connect to server');
});
```

## 客户端向服务端发送数据

```js
const net = require('net');

const client = new net.Socket();

client.connect({port:8888,host:'localhost'}, ()=>{
    client.write('hello server');
    console.log('client connect to server');
});

client.on('data', (data)=>{
    console.log(data.toString());
    client.write('get it');
});

client.on('end', ()=>{
    console.log('end event');
});
```

# UDP客户端服务端创建发送消息

## UDP客户端

```js
const dgram = require('dgram');

const message = Buffer.from('This message comes from server');
const socket = dgram.createSocket('udp4', (msg, info) => {

    socket.send(message, 0, message.length, info.port, info.address, (error, bytes) => {
        if (error) {
            return;
        }
        console.log('收到信息：'+msg);
        console.log('Server has send ' + bytes + ' byte message');
    });
});

socket.bind(9999, 'localhost', () => {
    console.log('Server has bind to 9999');
});
```

## UDP服务端

```js
const dgram = require('dgram');

const msg = Buffer.from('This message comes from client');
const socket = dgram.createSocket('udp4');

socket.send(msg, 0, msg.length, 9999, 'localhost', (error, bytes) => {
    if (error) {
        console.log(error);
        return;
    }
    console.log('client has sent ' + bytes + 'byte message');
});

socket.on('message', (msg, info) => {
    const message2Send = 'hello word';

    socket.send(message2Send, 0, message2Send.length, 9999, 'localhost');
});
```
